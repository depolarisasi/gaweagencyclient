analisis, investigasi dan buat perencanaan dari perintah saya dibawah ini lalu tuangkan dalam rencana perbaikan dalam file markdown dengan format to do seperti ini
- [ ] Task List 1
--> [ ] Sub Task 1
--> [ ] Sub Task 2
- [ ] Task List 2
--> [ ] Sub Task 1
--> [ ] Sub Task 2
- [ ] Task List 3

Berikut adalah hal yang harus anda analisis dan investigasi apakah sudah benar, atau harus ada perbaikan : 
1. di halaman /client/tickets/ pada list ticket pada summary isi ticket terdapat tag html contohnya di ticket #TKT202511100001
<div>adasdasdasd</div>. seharusnya tidak ada div ini, jadi isi dari summarynya di filter saja tag htmlnya 
2. periksa tentang proses pengiriman email pada seluruh proses ticket, karena saya test tidak ada email apapun yang terkirim
-> pada saat client / admin membuat ticket, salinan ticket dikirim ke email client sebagai konfirmasi
-> pada saat admin / staff reply ticket client, maka client yang membuka ticket akan mendapat email isi balasan ticket
-> pada saat ticket mark as resolved, closed, on progress. seluruh kabar ini diberitahukan ke client melalui email
3. pada ticket threads, lampiran yang diberikan client tidak ada, padahal ketika membuat ticket sudah melampirkan foto
4. pada reply section untuk admin admin/tickets/2#replySection tidak ada file input untuk attachment, tambahkan juga attachment untuk reply admin. dan di thread ticket ini tidak ada attachment dari user
5. Perbaiki tampilan invoice di invoice detail di client area karena tidak sesua idengan invoice yang client bayar
-> invoice item hanya berisikan services subscription saja, mohon tambahkan template apa yang dipakai client pada saat order
-> invoice item seharusnya terdapat juga addons (jika ada) atau domain (jika membeli baru)
-> hilangkan Biaya Admin (Merchant) karena ini tidak masuk dalam perhitungan apapun
6. pada orders detail, terdapat kesalahan karena billing cycle addons yang ditampilkan tidak sesuai dengan kenyataan siklusnya, addon tidak ada siklus per tahun hanya ada per bulan tetapi menampilkan per tahun. subscription adalah benar siklusnya per tahun
7. terdapat error ketika membatalkan addons
Illuminate\Database\QueryException
vendor\laravel\framework\src\Illuminate\Database\Connection.php:824
SQLSTATE[42S22]: Column not found: 1054 Unknown column 'cancel_at_period_end' in 'field list' (Connection: mysql, SQL: update `order_addons` set `cancel_at_period_end` = 1, `order_addons`.`updated_at` = 2025-11-10 16:19:55 where `id` = 71)

8. perbaiki tampilan invoice pdf karena tidak sesuai dengan yang client bayar, tidak ada addons, tidak ada domain, tidak ada keterangan template juga bentuknya kurang profesional
saya dengan tampilan kurang lebih seperti ini

==============================================================================
[LOGO ANDA / NAMA PERUSAHAAN ANDA]
[Alamat Perusahaan Anda]
[Kota, Kode Pos]
[Telepon Anda] | [Email Anda] | [Website Anda]

==============================================================================

                                                             INVOICE
                                                             STATUS: [LUNAS / BELUM LUNAS / DIBATALKAN]

DITAGIHKAN KEPADA (BILL TO):                     RINCIAN INVOICE:
[Nama Klien / Perusahaan Klien]                  Nomor Invoice     : [INV-2025-001]
[Nama Kontak Klien (jika ada)]                   Tanggal Terbit    : [DD/MM/YYYY]
[Alamat Klien]                                   Tanggal Jatuh Tempo : [DD/MM/YYYY]
[Email / Telepon Klien]

------------------------------------------------------------------------------
DESKRIPSI LAYANAN / PRODUK           QTY     HARGA SATUAN      JUMLAH (IDR)
------------------------------------------------------------------------------

[Nama Layanan/Produk 1]                [1]     [Rp 1.000.000]    [Rp 1.000.000]
(Deskripsi singkat item 1 di sini...)

[Nama Layanan/Produk 2]                [2]     [Rp   500.000]    [Rp 1.000.000]
(Deskripsi singkat item 2 di sini...)

[...tambahkan baris sesuai kebutuhan]

------------------------------------------------------------------------------
                                                          SUBTOTAL:   [Rp 2.000.000]
                                                [Pajak (e.g., PPN 11%)]:   [Rp   220.000]
                                                    [Diskon / Potongan]:   [Rp         0]
                                            ------------------------------
                                                     TOTAL TAGIHAN:   [Rp 2.220.000]

TERBILANG: [Dua juta dua ratus dua puluh ribu rupiah]
------------------------------------------------------------------------------

INFORMASI PEMBAYARAN (PAYMENT DETAILS):

Mohon lakukan pembayaran ke virtual account atau payment channel yang anda pilih di halaman invoice / billing.
apabila virtual account/qris/payment channel sudah tidak berlaku mohon hubungi customer support

CATATAN / KETENTUAN (NOTES / TERMS):
* Pembayaran mohon dilunasi paling lambat pada tanggal jatuh tempo.
* Mohon sertakan Nomor Invoice [INV-2025-001] pada bukti transfer.
* Terima kasih atas kepercayaan Anda.

==============================================================================
1. Audit beberapa hal berikut dan sampaikan hasil analisis investigasi anda
-> untuk subscription (orders) dan addons invoice di generate 14 hari sebelum jatuh tempo berikutnya
--> email dikirim setelah invoice generation untuk mengingatkan client
--> email reminder h-7 sebelum jatuh tempo
--> email reminder dikirim h-1 sebelum jatuh tempo
--> email reminder h+3 setelah jatuh tempo
--> email reminder h+7 setelah jatuh tempo
--> email reminder h+14 setelah jatuh tempo
---> auto cancel invoice setelah 14 hari jatuh tempo, orders inactive, project inactive (suspend)
2. Audit hal berikut
--> apakah setelah payment check oleh user di klik dari halaman checkout billing dan invoice detail di client area sudah bisa check payment transaksi di tripay?
--> apakah setelah invoice dinyatakan paid oleh tripay, order aktif dan invoice mark as paid? 
--> apakah email pembayaran diterima, orders dibuat, project dibuat dikirim setelah invoice mark as paid?
3. email pembayaran berhasil dikirimkan terlalu banyak, pada saat test saya menerima 7 email pembayaran diterima
4. pada email pembayaran diterima terdapat kesalahan dimana tanggal pembayaran di email tersebut malah tertulis **** bukan tanggal

1. perbaiki dengan menjalankan seluruh usulan perbaikan 
-- GenerateRecurringInvoices:
- Ubah window seleksi ke next_due_date <= now()->addDays(14) .
- Tetapkan status = 'sent' agar konsisten dengan PaymentController/UI.
- Tetapkan due_date = order->next_due_date (jatuh tempo sama dengan awal periode berikut).
- Jangan update order.next_due_date saat generate; baru update ke periode berikut ketika pembayaran sukses.
- Simpan is_renewal = true , billing_period_start = order->next_due_date , billing_period_end = calculateNextDueDate(...) .
-- Model Invoice:
- Tambah ke fillable dan casts bila ada kolom: is_renewal , billing_period_start , billing_period_end , payment_url , payment_code , payment_instructions , payment_expired_at .
- Sesuaikan scopes: gunakan sent untuk unpaid yang belum lewat due, overdue untuk yang lewat due_date .
-- SuspendOverdueProjects:
- Filter invoice status = 'overdue' dengan due_date < now()->subDays(14) dan is_renewal = true .
- Saat suspend, selain project.status = 'suspended' , set juga order.status = 'suspended' .
- Cancel invoice pada saat yang sama (menjaga single source of truth auto-cancel = H+14).
-- CancelExpiredInvoices:
- Ubah agar tidak langsung cancel saat lewat due_date . Gantikan dengan invoices:mark-overdue yang menandai status = 'overdue' ketika due_date < now() (tanpa cancel).
-- CancelUnpaidInvoices:
- Hapus atau ganti fungsinya agar tidak konflik; auto-cancel dilakukan terpusat di projects:suspend-overdue pada H+14.
-- Email reminders:
-- Tambahkan command harian invoices:send-reminders yang:
  - Mengirim “Invoice Generated” ketika invoice baru dibuat (atau langsung saat generate).
  - H-7 dan H-1: untuk status = 'sent' dan due_date - now() sama dengan 7 atau 1 hari.
  - H+3, H+7, H+14: untuk status = 'overdue' dan now() - due_date sama dengan 3/7/14 hari.
-- Tambahkan notifikasi:
  - InvoiceGeneratedNotification
  - InvoiceReminderBeforeDueNotification (parameter offset hari dan template)
  - InvoiceReminderAfterDueNotification (parameter offset hari dan template)
- Jadwalkan invoices:send-reminders daily di Kernel (mis. 08:00 ), idempoten (cek log/sent_at).
-- PaymentController:
- Pastikan seluruh alur membaca status 'sent' untuk invoice yang belum dibayar.
-- Order status:
- Konfirmasi apakah inactive disimpan sebagai status baru atau gunakan suspended agar seragam dengan project. Bila perlu tambah status inactive di enum dan UI.
2. addons ini bersifat bisa di cancel karena siklusnya berbeda dengan subscription, jadi pisahkan invoice addon dengan subscription ketika renewal
ketika renewal bisa jadi addon sudah dicancel di orders, apabila masih ada hingga jatuh tempo subscription berikutnya maka akan menjadi 1 invoice